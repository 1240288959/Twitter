<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>他的主页</title>
    <link rel="stylesheet" th:href="@{css/bootstrap.css}"/>
</head>
<body>
<div th:include="nav :: nav"></div>
<div class="col-sm-2">
    <div style="width: 210px;height: 250px;margin-bottom: 30px">
        <img class="img-circle" th:src="@{${attenteduser.user.getImageBase64()}}" alt="此处应该有my头像" style="width: 210px;height: 200px" />
        <button class="btn btn-primary center-block" th:if="${attenteduser.attented }"  th:onclick="'deleteattented(\''+${attenteduser.user.id}+'\',this)'" >关注中</button>
        <button class="btn btn-primary center-block" th:unless="${attenteduser.attented }"  th:onclick="'addattented(\''+${attenteduser.user.id}+'\',this)'" >关注</button>
        <p class="text-center" th:text="${attenteduser.user.name}"></p>
    </div>
</div>
<div class="col-sm-6 col-sm-offset-2">
    <!---此处是显示他个人推特的地方-->
    <div th:each="twitter:${list}" style="margin-bottom: 10px" th:onclick="'showmodal(\''+${twitter.twitter.id}+'\',\''+${twitter.twitter.title}+'\',\''+${twitter.twitter.user.name}+'\',
            \''+${twitter.twitter.date}+'\',\''+${twitter.twitter.content}+'\')'" >
        <h4 class="media-heading" th:text="${twitter.twitter.title}"></h4>
        <span th:text="${twitter.twitter.user.name}"></span>
        <span th:text="${twitter.twitter.date}"></span>
        <div style="width: 200px;word-break:break-all;">
            <p th:text="${twitter.twitter.content}"></p>
        </div>
    </div>
    <div th:include="twittermodelwindow :: twittermodelwindow"></div>
</div>

</body>
<script th:src="@{js/jquery.min.js}"></script>
<script th:src="@{js/bootstrap.js}"></script>
<script>
    function deleteattented(id,button) {
        console.log(id);
        $.ajax({
            url: "/deleteattented",
            type:"get",
            data:"id="+id,
            success:function (msg) {
                if(msg==true){
                    console.log("成功");
                    $(button).text("关注");
                    $(button).removeAttr("onclick");
                    $(button).attr("onclick","addattented(\'"+id+"\',this)");

                }else{
                    console.log("失败");
                }
                return false;
            }
        });
        return false;
    }

    function addattented(id,button) {
        console.log(id);
        $.ajax({
            url: "/addattented",
            type:"get",
            data:"id="+id,
            success:function (msg) {
                var btn="<button>关注中</button>";
                if(msg==true){
                    console.log("成功");
                    $(button).text("关注中");
                    $(button).removeAttr("onclick");
                    $(button).attr("onclick","deleteattented(\'"+id+"\',this)");

                }else{
                    console.log("失败");
                }
                return false;
            }
        });
        return false;
    }

    function updatacomment(id){
        $("#mydiv").empty();
        $.ajax({
            url:"/getComment",
            type:"get",
            data:"twitterid="+id,
            dataType:"json",
            success:function (msg) {
                console.log(msg);
                for(var i in msg){
                    console.log(msg[i]);
                    var div=document.createElement("div");
                    /* $(div).attr("class","div");*/
                    var div1=document.createElement("div");
                    /*$(div1).attr("class","col-sm-8");*/
                    $(div1).attr("style","word-break:break-all; word-wrap:break-word ;");

                    var div2=document.createElement("div");
                    /*$(div2).attr("class","col-sm-4");*/

                    var dcontent=document.createElement("p");
                    $(dcontent).html(msg[i].content);
                    $(dcontent).attr("class","text-left");



                    var date=document.createElement("span");
                    $(date).html(msg[i].date+"&nbsp;");

                    var duser=document.createElement("span");
                    $(duser).html(msg[i].user.name);

                    $(div1).append(dcontent);
                    $(div2).append(date,duser);
                    $(div).append(div1,div2);
                    $("#mydiv").append(div);
                }
                return false;
            }
        });
        return false;
    }

    function showmodal(id,title,username,date,content) {
        console.log(id);

        $("#myModal h4").html(title);
        $("#modal-id").html(id);
        $("#modal-username").html(username);
        $("#modal-date").html(date);
        $("#modal-content p").html(content);
        updatacomment(id);
        $("#myModal").modal("show");
    }
    $("#myModal").on("hidden",function () {
        $(this).removeData();
        $("#mydiv").remove();
    });

    function addcomment() {
        var id=$("#modal-id").html();
        $.ajax({
            url:"/addComment",
            type:"get",
            data:{
                content:$("#comment").val(),
                twitter:$("#modal-id").html()
            },
            success:function (msg) {
                if(msg==true){
                    updatacomment($("#modal-id").html());
                    $("#comment").val("");
                }
                return false;
            }
        });
        return false;
    }

    $("#addcomment").click(function () {
        addcomment();
    });

</script>
</html>