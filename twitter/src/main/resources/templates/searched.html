<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>查找用户</title>
    <link rel="stylesheet" th:href="@{css/bootstrap.css}"/>
</head>
<body>
<div th:include="nav :: nav"></div>
<div th:each="attenteduser:${list}" style="margin-bottom: 10px">
    <a th:href="'/tootherspage?id='+${attenteduser.user.id}+''">
        <img class="img-circle" style="width: 100px;height: 100px" th:src="@{${attenteduser.user.getImageBase64()}}" alt="...此处为查找到的头像"/>
    </a>
    <button class="btn btn-primary" th:if="${attenteduser.attented }"  th:onclick="'deleteattented(\''+${attenteduser.user.id}+'\',this)'" >关注中</button>
    <button class="btn btn-primary" th:unless="${attenteduser.attented }"  th:onclick="'addattented(\''+${attenteduser.user.id}+'\',this)'" >关注</button>
    <span th:text="${attenteduser.user.name}"></span>
</div>
</body>
<script th:src="@{js/jquery.min.js}" ></script>
<script th:src="@{js/bootstrap.js}"></script>
<script>
    function deleteattented(id,button) {
        console.log(id);
        $.ajax({
            url: "/deleteattented",
            type:"get",
            data:"id="+id,
            success:function (msg) {
                if(msg==true){
                    console.log("成功");
                    $(button).text("关注");
                    $(button).removeAttr("onclick");
                    $(button).attr("onclick","addattented(\'"+id+"\',this)");

                }else{
                    console.log("失败");
                }
                return false;
            }
        });
        return false;
    }

    function addattented(id,button) {
        console.log(id);
        $.ajax({
            url: "/addattented",
            type:"get",
            data:"id="+id,
            success:function (msg) {
                var btn="<button>关注中</button>";
                if(msg==true){
                    console.log("成功");
                    $(button).text("关注中");
                    $(button).removeAttr("onclick");
                    $(button).attr("onclick","deleteattented(\'"+id+"\',this)");

                }else{
                    console.log("失败");
                }
                return false;
            }
        });
        return false;
    }
</script>
</html>